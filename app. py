from flask import Flask, render_template, request, redirect
import sqlite3

app = Flask(__name__)

# Ma'lumotlar bazasini yaratish
def init_db():
    with sqlite3.connect("database.db") as conn:
        conn.execute("""
            CREATE TABLE IF NOT EXISTS bronlar (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                mijoz_ismi TEXT,
                mahsulot TEXT,
                narx TEXT,
                holat TEXT
            )
        """)

@app.route('/')
def index():
    with sqlite3.connect("database.db") as conn:
        cursor = conn.execute("SELECT * FROM bronlar ORDER BY id DESC")
        bronlar = cursor.fetchall()
    return render_template('index.html', bronlar=bronlar)

@app.route('/yuk_qoshish', methods=['POST'])
def yuk_qoshish():
    ism = request.form['ism']
    mahsulot = request.form['mahsulot']
    with sqlite3.connect("database.db") as conn:
        conn.execute("INSERT INTO bronlar (mijoz_ismi, mahsulot, narx, holat) VALUES (?, ?, ?, ?)",
                     (ism, mahsulot, "Kutilmoqda", "Yangi"))
    return redirect('/')

@app.route('/chiqarish/<int:bron_id>', methods=['POST'])
def chiqarish(bron_id):
    narx = request.form['narx']
    with sqlite3.connect("database.db") as conn:
        conn.execute("UPDATE bronlar SET holat=?, narx=? WHERE id=?",
                     ("Chiqdi", narx, bron_id))
    return redirect('/')

if __name__ == '__main__':
    init_db()
    app.run(debug=True)
